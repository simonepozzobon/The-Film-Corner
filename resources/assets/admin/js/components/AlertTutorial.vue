<template>
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="box container-fluid mb-4" ref="alert">
        <div class="row">
          <div :class="'col dark-'+color+' py-3 px-5'">
            <h3>{{title}}</h3>
          </div>
        </div>
        <div class="row">
          <div :class="'col '+color+' p-5'">
            <slot></slot>
            <div class="pt-5 d-flex justify-content-around">
              <a @click="removeAlert" href="#" :class="'btn btn-'+color+' btn-lg'">Ok ho capito</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import mojs from 'mo-js';
import _ from 'lodash'

export default {
  props: ['title', 'color', 'element', 'position'],
  data: () => ({
      el: '',
      pos: '',
  }),
  mounted() {
    var vue = this;
    class Arrow extends mojs.CustomShape {
      getShape() {
        return '<path d="M36.656,56.614 C32.552,56.343 28.449,56.072 24.345,55.801 C25.284,54.531 25.612,51.702 25.75,51.008 C26.876,45.339 27.792,39.63 28.624,33.91 C30.226,22.89 31.631,11.839 33.112,0.803 C33.192,0.207 32.426,-0.09 31.983,0.155 C29.87,1.324 27.757,2.494 25.644,3.663 C23.435,4.885 20.982,6.765 18.583,7.509 C15.733,8.393 13.161,5.971 10.896,4.47 C8.708,3.021 6.521,1.571 4.334,0.122 C3.728,-0.279 3.144,0.382 3.233,0.969 C4.604,10.085 5.975,19.201 7.346,28.317 C8.361,35.067 9.106,41.97 10.27,48.745 C10.068,48.753 10.024,49.107 10.241,49.142 C10.275,49.147 10.31,49.153 10.344,49.159 C10.681,51.091 11.048,53.014 11.473,54.917 C8.091,54.583 4.704,54.358 1.312,54.147 C0.873,54.12 0.436,54.642 0.607,55.073 C3.231,61.69 5.918,68.282 8.581,74.884 L8.94,75.775 C8.826,75.864 8.82,76.081 8.993,76.108 C9.021,76.113 9.051,76.117 9.08,76.121 C10.207,78.915 11.334,81.71 12.461,84.504 C13.269,86.507 13.836,88.546 15.604,89.891 C15.92,90.132 16.451,89.944 16.628,89.623 C22.73,78.496 29.633,67.852 37.305,57.744 C37.677,57.252 37.158,56.647 36.656,56.614 Z M15.785,88.064 C14.565,86.748 13.769,84.556 13.095,82.528 C14.044,82.664 14.995,82.795 15.951,82.845 C16.189,82.857 16.25,82.462 16.008,82.422 C14.999,82.258 13.977,82.183 12.956,82.11 C12.65,81.181 12.367,80.303 12.075,79.58 L12.075,79.58 C13.453,79.884 14.853,80.046 16.272,80.015 C16.602,80.008 16.603,79.505 16.272,79.502 C14.777,79.491 13.316,79.353 11.863,79.053 C11.502,78.157 11.14,77.261 10.779,76.366 C11.67,76.479 12.569,76.563 13.44,76.573 C13.727,76.576 13.808,76.107 13.51,76.058 C12.55,75.899 11.541,75.822 10.543,75.779 L9.592,73.421 C12.306,73.922 15.116,74.518 17.844,74.643 C18.11,74.655 18.164,74.244 17.907,74.18 C15.178,73.493 12.22,73.261 9.4,72.944 C9.151,72.327 8.902,71.71 8.653,71.093 C8.62,71.011 8.587,70.929 8.554,70.846 C10.715,70.921 12.792,71.196 14.95,71.496 C15.243,71.537 15.373,71.136 15.075,71.041 C12.979,70.374 10.577,70.22 8.365,70.377 C7.973,69.406 7.582,68.435 7.191,67.463 C9.779,67.934 12.415,68.41 15.027,68.583 C15.292,68.6 15.349,68.178 15.09,68.12 C12.449,67.528 9.687,67.242 6.986,66.954 C6.509,65.77 6.027,64.588 5.549,63.404 C7.749,63.78 9.97,64.102 12.182,64.371 C12.531,64.414 12.617,63.804 12.266,63.751 C9.969,63.405 7.648,63.101 5.334,62.871 C4.919,61.842 4.5,60.814 4.085,59.784 C6.88,60.165 9.692,60.617 12.489,60.887 C12.793,60.916 12.831,60.455 12.559,60.372 C9.885,59.548 6.72,59.235 3.871,59.254 C3.545,58.448 3.219,57.642 2.892,56.835 C4.093,57.321 5.489,57.357 6.766,57.534 C8.149,57.726 9.533,57.942 10.926,58.039 C11.228,58.06 11.3,57.562 10.998,57.506 C9.625,57.255 8.23,57.119 6.844,56.961 C5.535,56.812 4.141,56.487 2.832,56.685 C2.694,56.345 2.558,56.004 2.419,55.665 C5.541,55.819 8.662,55.954 11.789,55.991 C11.837,55.991 11.873,55.977 11.914,55.969 C12.266,56.134 12.798,55.944 12.763,55.469 C12.727,54.975 12.675,54.481 12.632,53.987 C14.551,54.156 16.453,54.047 18.385,54.318 C18.769,54.372 18.948,53.798 18.55,53.721 C16.701,53.362 14.457,53.089 12.593,53.537 C12.47,52.177 12.314,50.817 12.147,49.457 C13.935,49.755 15.734,50.051 17.528,50.197 C17.83,50.222 17.901,49.721 17.6,49.664 C15.788,49.32 13.928,49.126 12.081,48.934 C11.963,48.003 11.836,47.072 11.703,46.141 C13.224,46.349 14.757,46.54 16.282,46.604 C16.543,46.615 16.61,46.187 16.345,46.141 C14.791,45.87 13.203,45.727 11.624,45.603 C11.474,44.573 11.311,43.543 11.149,42.513 C13.725,42.509 16.212,42.915 18.75,43.421 C19.035,43.478 19.152,43.072 18.871,42.983 C16.361,42.194 13.707,42.009 11.085,42.094 C10.909,40.987 10.729,39.88 10.546,38.774 C12.367,38.747 14.123,38.997 15.896,39.422 C16.21,39.497 16.337,39.035 16.029,38.939 C14.229,38.374 12.347,38.21 10.47,38.316 C10.297,37.27 10.124,36.226 9.951,35.182 C13.102,35.692 16.263,36.207 19.431,36.572 C19.748,36.609 19.825,36.064 19.507,36.01 C16.315,35.468 13.085,35.078 9.869,34.681 C9.66,33.418 9.456,32.156 9.256,30.896 C9.285,30.909 9.319,30.918 9.36,30.917 C11.382,30.903 13.33,31.031 15.334,31.299 C15.665,31.343 15.74,30.781 15.413,30.714 C13.444,30.314 11.354,30.225 9.359,30.457 C9.29,30.465 9.237,30.497 9.199,30.54 C9.094,29.873 8.988,29.206 8.888,28.541 C8.754,27.653 8.621,26.765 8.487,25.877 C11.83,26.105 15.154,26.518 18.493,26.76 C18.798,26.782 18.87,26.279 18.566,26.222 C15.252,25.597 11.789,25.454 8.424,25.453 C8.196,23.936 7.968,22.418 7.74,20.901 C9.954,21.035 12.176,21.185 14.391,21.199 C14.732,21.201 14.724,20.7 14.391,20.674 C12.158,20.503 9.908,20.468 7.667,20.417 C7.467,19.085 7.266,17.753 7.066,16.421 C11.07,16.819 15.089,17.224 19.108,17.412 C19.444,17.428 19.429,16.934 19.108,16.899 C15.09,16.456 11.038,16.228 7.002,15.994 C6.809,14.712 6.616,13.429 6.424,12.147 C8.341,12.384 10.274,12.558 12.193,12.715 C12.585,12.747 12.577,12.147 12.193,12.108 C10.253,11.911 8.295,11.726 6.343,11.612 C6.13,10.193 5.916,8.773 5.703,7.354 C7.435,7.397 9.119,7.476 10.847,7.725 C11.244,7.782 11.424,7.183 11.016,7.111 C9.262,6.801 7.408,6.673 5.625,6.84 C5.398,5.334 5.172,3.828 4.946,2.322 C7.183,3.805 9.421,5.287 11.658,6.77 C13.296,7.856 15.185,9.553 17.297,9.456 C19.548,9.353 21.882,7.462 23.765,6.421 C26.321,5.007 28.877,3.592 31.433,2.178 C30.28,10.783 29.144,19.39 27.96,27.991 C27.369,32.286 26.751,36.579 26.055,40.858 C25.724,42.895 25.375,44.93 25.002,46.96 C24.863,47.716 23.245,54.937 23.111,54.852 C22.337,54.356 21.705,55.533 22.406,56.058 C22.419,56.067 22.43,56.074 22.443,56.083 C22.242,56.515 22.457,57.18 23.091,57.222 C27.141,57.489 31.192,57.756 35.242,58.023 C28.061,67.577 21.567,77.605 15.785,88.064 Z"></path>';
      }
    }
    mojs.addShape( 'arrow', Arrow );

    this.el = document.getElementById(this.element);
    this.left = this.getOffsetLeft(this.el);
    this.top = this.getOffsetTop(this.el);

    this.arrow = new mojs.Shape({
      shape: 'arrow',
      parent: 'body',
      class: '.arrow',
      top: 0,
      left: 0,
      x: {[(this.left) - this.el.offsetWidth - 20] : (this.left) - this.el.offsetWidth},
      y: {[this.top + this.el.offsetHeight + 20] : this.top + this.el.offsetHeight},
      fill: '#e9c845',
      radius: 50,
      angle: 225,
      easing: 'sin.in'
    })
    .then({
      x: {[(this.left) - this.el.offsetWidth] : (this.left) - this.el.offsetWidth - 20},
      y: {[this.top + this.el.offsetHeight] : this.top + this.el.offsetHeight + 20},
      onComplete() {
        this.replay();
        vue.burst.play();
      }
    })
    .play();

    this.burst = new mojs.Burst({
      top: 0,
      left: 0,
      count: 8,
      x: this.left + (this.el.offsetWidth / 2),
      y: this.top + (this.el.offsetHeight / 2),
      children: {
        shape: 'line',
        stroke: '#e9c845'
      }
    });

  },
  methods: {
    removeAlert()
    {
      var vue = this;


      this.alert = new mojs.Html({
        el: this.$refs['alert'],
        opacity: {1 : 0}
      }).then({
        height: {[this.$refs['alert'].offsetHeight] : 0},
        onComplete() {
          vue.deleteEl(this.el);
        }
      });

      this.arrow.tune({
        opacity: {1 : 0},
        onComplete() {
          this.stop();
          vue.alert.play();
        }
      });
    },

    getOffsetLeft (elem)
    {
        var offsetLeft = 0;
        do {
          if ( !isNaN( elem.offsetLeft ) )
          {
              offsetLeft += elem.offsetLeft;
          }
        } while( elem = elem.offsetParent );
        return offsetLeft;
    },

    getOffsetTop (elem)
    {
        var offsetTop = 0;
        do {
          if ( !isNaN( elem.offsetTop ) )
          {
              offsetTop += elem.offsetTop;
          }
        } while( elem = elem.offsetParent );
        return offsetTop;
    },

    deleteEl(el) {
        if (el) {
             el.parentNode.removeChild(el);
        }
    },
  }
}
</script>
<style lang="scss" scoped>
  // :not(#dont-blur-me-bro)
</style>
